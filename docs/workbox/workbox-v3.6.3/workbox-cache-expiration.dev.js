this.workbox=this.workbox||{},this.workbox.expiration=function(l,h,i,o,s,p,x){"use strict";try{self.workbox.v["workbox:cache-expiration:3.6.3"]=1}catch(e){}const u="url",c="timestamp";class g{constructor(e){this._cacheName=e,this._storeName=e,this._db=new h.DBWrapper(this._cacheName,2,{onupgradeneeded:r=>this._handleUpgrade(r)})}_handleUpgrade(e){const r=e.target.result;e.oldVersion<2&&r.objectStoreNames.contains("workbox-cache-expiration")&&r.deleteObjectStore("workbox-cache-expiration"),r.createObjectStore(this._storeName,{keyPath:u}).createIndex(c,c,{unique:!1})}setTimestamp(e,r){var t=this;return babelHelpers.asyncToGenerator(function*(){yield t._db.put(t._storeName,{[u]:new URL(e,location).href,[c]:r})})()}getAllTimestamps(){var e=this;return babelHelpers.asyncToGenerator(function*(){return yield e._db.getAllMatching(e._storeName,{index:c})})()}getTimestamp(e){var r=this;return babelHelpers.asyncToGenerator(function*(){const t=yield r._db.get(r._storeName,e);return t.timestamp})()}deleteUrl(e){var r=this;return babelHelpers.asyncToGenerator(function*(){yield r._db.delete(r._storeName,new URL(e,location).href)})()}delete(){var e=this;return babelHelpers.asyncToGenerator(function*(){yield e._db.deleteDatabase(),e._db=null})()}}class d{constructor(e,r={}){{if(o.assert.isType(e,"string",{moduleName:"workbox-cache-expiration",className:"CacheExpiration",funcName:"constructor",paramName:"cacheName"}),!(r.maxEntries||r.maxAgeSeconds))throw new i.WorkboxError("max-entries-or-age-required",{moduleName:"workbox-cache-expiration",className:"CacheExpiration",funcName:"constructor"});r.maxEntries&&o.assert.isType(r.maxEntries,"number",{moduleName:"workbox-cache-expiration",className:"CacheExpiration",funcName:"constructor",paramName:"config.maxEntries"}),r.maxAgeSeconds&&o.assert.isType(r.maxAgeSeconds,"number",{moduleName:"workbox-cache-expiration",className:"CacheExpiration",funcName:"constructor",paramName:"config.maxAgeSeconds"})}this._isRunning=!1,this._rerunRequested=!1,this._maxEntries=r.maxEntries,this._maxAgeSeconds=r.maxAgeSeconds,this._cacheName=e,this._timestampModel=new g(e)}expireEntries(){var e=this;return babelHelpers.asyncToGenerator(function*(){if(e._isRunning){e._rerunRequested=!0;return}e._isRunning=!0;const r=Date.now(),t=yield e._findOldEntries(r),a=yield e._findExtraEntries(),n=[...new Set(t.concat(a))];yield Promise.all([e._deleteFromCache(n),e._deleteFromIDB(n)]),n.length>0?(s.logger.groupCollapsed(`Expired ${n.length} ${n.length===1?"entry":"entries"} and removed ${n.length===1?"it":"them"} from the '${e._cacheName}' cache.`),s.logger.log(`Expired the following ${n.length===1?"URL":"URLs"}:`),n.forEach(function(m){return s.logger.log(`    ${m}`)}),s.logger.groupEnd()):s.logger.debug("Cache expiration ran and found no entries to remove."),e._isRunning=!1,e._rerunRequested&&(e._rerunRequested=!1,e.expireEntries())})()}_findOldEntries(e){var r=this;return babelHelpers.asyncToGenerator(function*(){if(o.assert.isType(e,"number",{moduleName:"workbox-cache-expiration",className:"CacheExpiration",funcName:"_findOldEntries",paramName:"expireFromTimestamp"}),!r._maxAgeSeconds)return[];const t=e-r._maxAgeSeconds*1e3,a=yield r._timestampModel.getAllTimestamps(),n=[];return a.forEach(function(m){m.timestamp<t&&n.push(m.url)}),n})()}_findExtraEntries(){var e=this;return babelHelpers.asyncToGenerator(function*(){const r=[];if(!e._maxEntries)return[];const t=yield e._timestampModel.getAllTimestamps();for(;t.length>e._maxEntries;){const a=t.shift();r.push(a.url)}return r})()}_deleteFromCache(e){var r=this;return babelHelpers.asyncToGenerator(function*(){const t=yield caches.open(r._cacheName);for(const a of e)yield t.delete(a)})()}_deleteFromIDB(e){var r=this;return babelHelpers.asyncToGenerator(function*(){for(const t of e)yield r._timestampModel.deleteUrl(t)})()}updateTimestamp(e){var r=this;return babelHelpers.asyncToGenerator(function*(){o.assert.isType(e,"string",{moduleName:"workbox-cache-expiration",className:"CacheExpiration",funcName:"updateTimestamp",paramName:"url"});const t=new URL(e,location);t.hash="",yield r._timestampModel.setTimestamp(t.href,Date.now())})()}isURLExpired(e){var r=this;return babelHelpers.asyncToGenerator(function*(){if(!r._maxAgeSeconds)throw new i.WorkboxError("expired-test-without-max-age",{methodName:"isURLExpired",paramName:"maxAgeSeconds"});const t=new URL(e,location);t.hash="";const a=yield r._timestampModel.getTimestamp(t.href),n=Date.now()-r._maxAgeSeconds*1e3;return a<n})()}delete(){var e=this;return babelHelpers.asyncToGenerator(function*(){e._rerunRequested=!1,yield e._timestampModel.delete()})()}}class b{constructor(e={}){{if(!(e.maxEntries||e.maxAgeSeconds))throw new i.WorkboxError("max-entries-or-age-required",{moduleName:"workbox-cache-expiration",className:"Plugin",funcName:"constructor"});e.maxEntries&&o.assert.isType(e.maxEntries,"number",{moduleName:"workbox-cache-expiration",className:"Plugin",funcName:"constructor",paramName:"config.maxEntries"}),e.maxAgeSeconds&&o.assert.isType(e.maxAgeSeconds,"number",{moduleName:"workbox-cache-expiration",className:"Plugin",funcName:"constructor",paramName:"config.maxAgeSeconds"})}this._config=e,this._maxAgeSeconds=e.maxAgeSeconds,this._cacheExpirations=new Map,e.purgeOnQuotaError&&x.registerQuotaErrorCallback(()=>this.deleteCacheAndMetadata())}_getCacheExpiration(e){if(e===p.cacheNames.getRuntimeName())throw new i.WorkboxError("expire-custom-caches-only");let r=this._cacheExpirations.get(e);return r||(r=new d(e,this._config),this._cacheExpirations.set(e,r)),r}cachedResponseWillBeUsed({cacheName:e,cachedResponse:r}){if(!r)return null;let t=this._isResponseDateFresh(r);const a=this._getCacheExpiration(e);return a.expireEntries(),t?r:null}_isResponseDateFresh(e){if(!this._maxAgeSeconds)return!0;const r=this._getDateHeaderTimestamp(e);if(r===null)return!0;const t=Date.now();return r>=t-this._maxAgeSeconds*1e3}_getDateHeaderTimestamp(e){if(!e.headers.has("date"))return null;const r=e.headers.get("date"),t=new Date(r),a=t.getTime();return isNaN(a)?null:a}cacheDidUpdate({cacheName:e,request:r}){var t=this;return babelHelpers.asyncToGenerator(function*(){o.assert.isType(e,"string",{moduleName:"workbox-cache-expiration",className:"Plugin",funcName:"cacheDidUpdate",paramName:"cacheName"}),o.assert.isInstance(r,Request,{moduleName:"workbox-cache-expiration",className:"Plugin",funcName:"cacheDidUpdate",paramName:"request"});const a=t._getCacheExpiration(e);yield a.updateTimestamp(r.url),yield a.expireEntries()})()}deleteCacheAndMetadata(){var e=this;return babelHelpers.asyncToGenerator(function*(){for(const[r,t]of e._cacheExpirations)yield caches.delete(r),yield t.delete();e._cacheExpirations=new Map})()}}return l.CacheExpiration=d,l.Plugin=b,l}({},workbox.core._private,workbox.core._private,workbox.core._private,workbox.core._private,workbox.core._private,workbox.core);
